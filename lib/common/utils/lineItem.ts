import {
  array,
  boolean,
  number,
  object,
  optional,
  string,
  type Describe,
  type Infer,
} from "superstruct";
import type { LineItem } from "../../client/services/lineItem/lineItem.type";
import { DateTimeStruct } from "../types";
import {
  CustomPacingCurveStruct,
  LineItemActivityAssociationStruct,
  LineItemDealInfoDtoStruct,
} from "../../client/common/types/lineItemSummary.type";
import {
  StatsStruct,
  MoneyStruct,
  AppliedLabelStruct,
  ThirdPartyMeasurementSettingsStruct,
  GoalStruct,
  GrpSettingsStruct,
  CreativePlaceholderStruct,
  TargetingStruct,
  CreativeTargetingStruct,
  FrequencyCapStruct,
  DeliveryIndicatorStruct,
  DeliveryDataStruct,
  BaseCustomFieldValueStruct,
} from "../../client/common/types";
import {
  AllowedFormatsEnum,
  ChildContentEligibilityEnum,
  CompanionDeliveryOptionEnum,
  CompetitiveConstraintScopeEnum,
  CostTypeEnum,
  CreativeRotationTypeEnum,
  DeliveryForecastSourceEnum,
  DeliveryRateTypeEnum,
  EnvironmentTypeEnum,
  LineItemDiscountTypeEnum,
  LineItemSummaryReservationStatusEnum,
  LineItemTypeEnum,
  ProgrammaticCreativeSourceEnum,
  RoadblockingTypeEnum,
  SkippableAdTypeEnum,
  StatusEnum,
} from "../../client/common/enums";
import { StartDateTimeTypeEnum } from "../enums";

/**
 * Represents a LineItem struct
 * we would be able to reuse this struct in other repositories for type safety checks
 * check https://github.com/guardian/ad-manager-line-items-jobs/pull/13#discussion_r1926802813 for more details
 */
export const LineItemStruct = object({
  orderId: number(),
  id: number(),
  name: string(),
  externalId: string(),
  orderName: string(),
  startDateTime: DateTimeStruct,
  startDateTimeType: StartDateTimeTypeEnum,
  endDateTime: optional(DateTimeStruct),
  autoExtensionDays: number(),
  unlimitedEndDateTime: boolean(),
  creativeRotationType: CreativeRotationTypeEnum,
  deliveryRateType: DeliveryRateTypeEnum,
  deliveryForecastSource: DeliveryForecastSourceEnum,
  customPacingCurve: CustomPacingCurveStruct,
  roadblockingType: RoadblockingTypeEnum,
  skippableAdType: SkippableAdTypeEnum,
  frequencyCaps: array(FrequencyCapStruct),
  lineItemType: LineItemTypeEnum,
  priority: number(),
  costPerUnit: MoneyStruct,
  valueCostPerUnit: MoneyStruct,
  costType: CostTypeEnum,
  discountType: LineItemDiscountTypeEnum,
  discount: number(),
  contractedUnitsBought: number(),
  creativePlaceholders: array(CreativePlaceholderStruct),
  activityAssociations: array(LineItemActivityAssociationStruct),
  environmentType: EnvironmentTypeEnum,
  allowedFormats: array(AllowedFormatsEnum),
  companionDeliveryOption: CompanionDeliveryOptionEnum,
  allowOverbook: boolean(),
  skipInventoryCheck: boolean(),
  skipCrossSellingRuleWarningChecks: boolean(),
  reserveAtCreation: boolean(),
  stats: StatsStruct,
  deliveryIndicator: DeliveryIndicatorStruct,
  deliveryData: DeliveryDataStruct,
  budget: MoneyStruct,
  status: StatusEnum,
  reservationStatus: LineItemSummaryReservationStatusEnum,
  isArchived: boolean(),
  webPropertyCode: string(),
  appliedLabels: optional(array(AppliedLabelStruct)),
  effectiveAppliedLabels: optional(array(AppliedLabelStruct)),
  disableSameAdvertiserCompetitiveExclusion: boolean(),
  lastModifiedByApp: string(),
  notes: string(),
  competitiveConstraintScope: CompetitiveConstraintScopeEnum,
  lastModifiedDateTime: DateTimeStruct,
  creationDateTime: DateTimeStruct,
  customFieldValues: array(BaseCustomFieldValueStruct),
  isMissingCreatives: boolean(),
  programmaticCreativeSource: ProgrammaticCreativeSourceEnum,
  thirdPartyMeasurementSettings: ThirdPartyMeasurementSettingsStruct,
  videoMaxDuration: number(),
  primaryGoal: GoalStruct,
  secondaryGoals: array(GoalStruct),
  grpSettings: GrpSettingsStruct,
  dealInfo: LineItemDealInfoDtoStruct,
  viewabilityProviderCompanyIds: array(number()),
  childContentEligibility: ChildContentEligibilityEnum,
  customVastExtension: string(),
  targeting: TargetingStruct,
  creativeTargetings: array(CreativeTargetingStruct),
}) as Describe<LineItem>;

type LineItemValidation = Infer<typeof LineItemStruct>;

export type { LineItemValidation };
